apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-traefik
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "10"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: traefik
  source:
    repoURL: https://traefik.github.io/charts
    chart: traefik
    targetRevision: 34.2.0
    helm:
      releaseName: traefik
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-cert-manager
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "20"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: cert-manager
  source:
    repoURL: https://charts.jetstack.io
    chart: cert-manager
    targetRevision: v1.16.2
    helm:
      releaseName: cert-manager
      values: |
        installCRDs: true
        startupapicheck:
          enabled: false
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-external-secrets
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "20"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: external-secrets
  source:
    repoURL: https://charts.external-secrets.io
    chart: external-secrets
    targetRevision: 0.11.0
    helm:
      releaseName: external-secrets
      values: |
        installCRDs: true
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-kyverno
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "20"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: kyverno
  source:
    repoURL: https://kyverno.github.io/kyverno
    chart: kyverno
    targetRevision: 3.3.7
    helm:
      releaseName: kyverno
      values: |
        webhooksCleanup:
          enabled: false
        policyReportsCleanup:
          enabled: false
        admissionController:
          replicas: 2
        backgroundController:
          replicas: 1
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-argo-rollouts
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "20"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: argo-rollouts
  source:
    repoURL: https://argoproj.github.io/argo-helm
    chart: argo-rollouts
    targetRevision: 2.38.0
    helm:
      releaseName: argo-rollouts
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-trivy-operator
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "25"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: trivy-system
  source:
    repoURL: https://aquasecurity.github.io/helm-charts
    chart: trivy-operator
    targetRevision: 0.24.1
    helm:
      releaseName: trivy-operator
      values: |
        operator:
          clusterComplianceEnabled: false
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-falco
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "25"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: falco
  source:
    repoURL: https://falcosecurity.github.io/charts
    chart: falco
    targetRevision: 4.19.0
    helm:
      releaseName: falco
      values: |
        driver:
          kind: modern_ebpf
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-step-issuer
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "25"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: step-issuer
  source:
    repoURL: https://smallstep.github.io/helm-charts
    chart: step-issuer
    targetRevision: 1.8.0
    helm:
      releaseName: step-issuer
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
      - ServerSideApply=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-otel-collector
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "30"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: observability
  source:
    repoURL: https://open-telemetry.github.io/opentelemetry-helm-charts
    chart: opentelemetry-collector
    targetRevision: 0.112.0
    helm:
      releaseName: otel-collector
      values: |
        image:
          repository: otel/opentelemetry-collector-k8s
        mode: daemonset
        config:
          receivers:
            otlp:
              protocols:
                grpc: {}
                http: {}
          processors:
            batch: {}
          exporters:
            otlp:
              endpoint: tempo.observability.svc.cluster.local:4317
              tls:
                insecure: true
          service:
            pipelines:
              traces:
                receivers: [otlp]
                processors: [batch]
                exporters: [otlp]
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-kube-prometheus-stack
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "30"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: observability
  source:
    repoURL: https://prometheus-community.github.io/helm-charts
    chart: kube-prometheus-stack
    targetRevision: 66.2.1
    helm:
      releaseName: kube-prometheus-stack
      values: |
        grafana:
          enabled: false
        alertmanager:
          enabled: false
        kube-state-metrics:
          enabled: false
        prometheus-node-exporter:
          enabled: false
        defaultRules:
          create: false
        prometheus:
          prometheusSpec:
            retention: 2h
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-cosign-public-key
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "35"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: kyverno
  source:
    repoURL: __REPO_URL__
    targetRevision: __GITOPS_REVISION__
    path: gitops/apps/security/cosign-public-key
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-slo-alerts
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "35"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: observability
  source:
    repoURL: __REPO_URL__
    targetRevision: __GITOPS_REVISION__
    path: slo
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-kyverno-policies
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "40"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: kyverno
  source:
    repoURL: __REPO_URL__
    targetRevision: __GITOPS_REVISION__
    path: policies/kyverno/env/prod
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-external-secret-config
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "45"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
    namespace: external-secrets
  source:
    repoURL: __REPO_URL__
    targetRevision: __GITOPS_REVISION__
    path: gitops/apps/secrets/prod
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-step-cluster-issuer
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "46"
spec:
  project: platform-core
  destination:
    name: sgp-prod-platform
  source:
    repoURL: __REPO_URL__
    targetRevision: __GITOPS_REVISION__
    path: gitops/apps/pki/cluster-issuers/prod
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-podinfo
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "50"
spec:
  project: workloads-prod
  destination:
    name: sgp-prod-workloads
    namespace: apps
  source:
    repoURL: __REPO_URL__
    targetRevision: __GITOPS_REVISION__
    path: gitops/apps/workloads/podinfo/overlays/prod
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prod-demo-app
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "55"
spec:
  project: workloads-prod
  destination:
    name: sgp-prod-workloads
    namespace: apps
  source:
    repoURL: __REPO_URL__
    targetRevision: __GITOPS_REVISION__
    path: gitops/apps/workloads/demo-app/overlays/prod
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
